# Vulnerability recurrence 

### The first loophole to reproduce is  CVE-2020-1021 

The code is based on an excellent vulnerability report  https://github.com/guhe120/Windows-EoP/blob/master/CVE-2020-1021/writeup.docx 

This code is only capable of triggering vulnerabilities wersvc!CWerService::SvcCollectMemoryInfo

My experimental environment is 1903 x64

I want to record something：

If the MaxMessageLength field in the fourth parameter ALPC_PORT_ATTRIBUTES of NtAlpcConnectPort is not set, then the length of the message sent by NtAlpcSendWaitReceivePort cannot exceed 0x200, and a 0xC000002F will be returned

If the sending length exceeds the maximum length specified by the server (NtAlpcSendWaitReceivePort is the third parameter from the bottom), you will get a 0xC0000707 

CreateFile will not be affected by disk storage space. WriteFile will 

### The second recurring vulnerability is CVE-2020-1515 

My experimental environment is 1903 x64

This is an integer overflow vulnerability in tapisrv.dll. From the perspective of the patch, the functions that have been patched include PInitialize, LInitialize, GetUIDllName and other functions, and the causes of the vulnerability are all integers, overflow

To call these functions, you need to connect to the tapisrv.dll server as an rpc client, and then you need to call ClientAttach to get a context_handle, and then call ClientAttach. ClientAttach will choose which function to call according to the value of parameter three

This code calls PInitialize, bypasses IsBadStringParam, but is only close to overflow 

1: kd>   
tapisrv!PInitialize+0xa3:  
0033:00007ffe 39672a63 4503c7 add r8d,r15d  
1: kd>   
tapisrv!PInitialize+0xa6:   
0033:00007ffe 39672a66 ff15dc980100 call qword ptr [tapisrv!_imp_HeapAlloc (00007ffe 3968c348)]   
1: kd> r r8   
r8=00000000ffffff6c    

I want to record something： 

By default, the rpc server will have the parameter to check [in], but not [out], because the server will not accept the value with the [out] parameter, but only accepts a format like this

rpc view will not decompile whether idl is an implicit handle or a display handle, you need to try it yourself 

